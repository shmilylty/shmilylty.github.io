<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[PHP CTF tricks parse_str and loose comparison]]></title>
      <url>/2017/09/29/PHP-CTF-tricks-parse-str-and-loose-comparison/</url>
      <content type="html"><![CDATA[<h2 id="0x00-题目"><a href="#0x00-题目" class="headerlink" title="0x00 题目"></a>0x00 题目</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;meta charset=<span class="string">"utf-8"</span>&gt;</div><div class="line"><span class="meta">&lt;?php</span></div><div class="line">error_reporting(<span class="number">0</span>);</div><div class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>($_GET[<span class="string">'str'</span>])) &#123;</div><div class="line">    show_source(<span class="keyword">__FILE__</span>);</div><div class="line">    <span class="keyword">die</span>();</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">    <span class="keyword">include</span>(<span class="string">'flag.php'</span>);</div><div class="line">    $url = <span class="string">"www.hackfun.org"</span>;</div><div class="line">    $str = $_GET[<span class="string">'str'</span>];</div><div class="line">    @parse_str($str);</div><div class="line">    <span class="keyword">if</span> ($url[<span class="number">0</span>] != <span class="string">'QNKCDZO'</span> &amp;&amp; md5($url[<span class="number">0</span>]) == md5(<span class="string">'QNKCDZO'</span>)) &#123;</div><div class="line">        <span class="keyword">echo</span> $flag;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">exit</span>(<span class="string">'Try angain :-)'</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<h2 id="0x01-解题"><a href="#0x01-解题" class="headerlink" title="0x01 解题"></a>0x01 解题</h2><p>要得到flag首先要使<code>if ($url[0] != &#39;QNKCDZO&#39; &amp;&amp; md5($url[0]) == md5(&#39;QNKCDZO&#39;))</code>成立，也就是<code>$url[0] != &#39;QNKCDZO&#39;</code>和<code>md5($url[0]) == md5(&#39;QNKCDZO&#39;)</code>都成立，如果str正常传入情况下，<code>$url[0]</code>的值是’w’，满足第一个条件<code>$url[0] != &#39;QNKCDZO&#39;</code>，但是不满足<code>md5($url[0]) == md5(&#39;QNKCDZO&#39;)</code>，但是代码中写了<code>@parse_str($str)</code>;，而<a href="http://www.w3school.com.cn/php/func_string_parse_str.asp" target="_blank" rel="external">parse_str()</a>函数会把参数字符串当做php变量解析，也就是如果str传入的是<code>url[0]=hello</code>，那么就会解析成一个数组url，且数组url的第一个值为hello，此时<code>$url[0] != &#39;QNKCDZO&#39;</code>成立，<code>md5($url[0]) == md5(&#39;QNKCDZO&#39;)</code>不成立，但是至少<code>$url[0]</code>的值可控了，仔细研究<code>md5($url[0]) == md5(&#39;QNKCDZO&#39;)</code>，可以发现<code>md5(&#39;QNKCDZO&#39;)</code>的值为字符型的’0e830400451993494058024219903391’，但是根据<a href="http://php.net/manual/zh/language.operators.comparison.php" target="_blank" rel="external">PHP手册</a>的描述：如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换为数值并且比较按照数值来进行。其中0e是科学计数法，因为涉及到数字内容，所以就会转换为数值，而’0e830400451993494058024219903391’转换为数值也就是0*(10^830400451993494058024219903391) = 0，所以我们只需要使<code>url[0]</code>的MD5值为类似0e开头后面全为数字的字符串就可以让<code>md5($url[0]) == md5(&#39;QNKCDZO&#39;)</code>成立，通过搜索发现很多字符串都满足条件，具体满足条件的列表可看。</p>
<ul>
<li><a href="http://blog.csdn.net/kalbertlee/article/details/70213392" target="_blank" rel="external">0e开头MD5 python生成脚本 PHP哈希弱类型比较缺陷</a></li>
<li><a href="http://www.cnblogs.com/Primzahl/p/6018158.html" target="_blank" rel="external">PHP处理0e开头md5哈希字符串缺陷/bug</a></li>
</ul>
<p>我们选取240610708作为<code>url[0]</code>的值，也就是使str传入的值为<code>url[0]=240610708</code>，此时<code>$url[0] != &#39;QNKCDZO&#39;</code>成立，且<code>md5($url[0]) == md5(&#39;QNKCDZO&#39;)</code>也成立：</p>
<p><img src="https://sunnyelf.github.io/downloads/2017-09-27-flag.jpg" alt="flag"></p>
]]></content>
      
        
        <tags>
            
            <tag> PHP CTF tricks </tag>
            
            <tag> parse_str </tag>
            
            <tag> loose comparison </tag>
            
        </tags>
        
    </entry>
    
  
  
    
    <entry>
      <title><![CDATA[about]]></title>
      <url>/about/index.html</url>
      <content type="html"><![CDATA[<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">root@hackfun:/<span class="comment"># python /tmp/sunnyelf/bio.py</span></div><div class="line">Hi, guys, I am a student of information security professional.</div><div class="line">At the same time I am a CTF enthusiast, be good at Web and Misc.</div><div class="line">At present, I am an information security company internship,</div><div class="line">engaged <span class="keyword">in</span> forensic analysis and penetration testing work.</div><div class="line">root@hackfun<span class="comment"># cd /tmp/sunnyelf/bio; rm -rf *</span></div><div class="line">bash: <span class="built_in">cd</span>: /tmp/sunnyelf/bio: No such file or directory</div><div class="line">...</div><div class="line">... and after a <span class="keyword">while</span> ...</div><div class="line">...</div><div class="line">^C</div><div class="line">Oh,no!...</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[link]]></title>
      <url>/link/index.html</url>
      <content type="html"><![CDATA[<p>想要申请友情链接的小伙伴可以先加好我的博客链接,然后在评论里面回复你的网站名称和网站地址,我会及时添加:P</p>
<p><strong>比如：</strong></p>
<blockquote>
<p>网站名称：Hackfun<br>网站地址：<a href="https://www.hackfun.org" target="_blank" rel="external">https://www.hackfun.org</a></p>
</blockquote>
<hr>
<h1 id="个人博客"><a href="#个人博客" class="headerlink" title="个人博客"></a>个人博客</h1><ul>
<li><a href="http://www.yqxiaojunjie.com/" target="_blank" rel="external">乐清小俊杰</a></li>
<li><a href="http://www.xianyusec.com/" target="_blank" rel="external">咸鱼在路上</a></li>
<li><a href="http://www.mxny.org/" target="_blank" rel="external">麦香浓郁</a></li>
<li><a href="http://blog.nuptzj.cn/" target="_blank" rel="external">画船听雨</a></li>
<li><a href="http://www.bodkin.ren/" target="_blank" rel="external">老锥</a></li>
<li><a href="http://www.nulll.me" target="_blank" rel="external">滥情</a></li>
<li><a href="http://www.ycjcl.cc/" target="_blank" rel="external">信鑫</a></li>
<li><a href="http://www.exehack.net/" target="_blank" rel="external">小残</a></li>
<li><a href="http://blog.d99net.net/" target="_blank" rel="external">啊D</a></li>
<li><a href="http://metasploit.lofter.com/" target="_blank" rel="external">风迷</a></li>
<li><a href="https://milktea.info" target="_blank" rel="external">奶茶</a></li>
<li><a href="http://venxi.me" target="_blank" rel="external">文曦</a></li>
<li><a href="http://bl4ck.in/" target="_blank" rel="external">Tomato</a></li>
<li><a href="http://www.cnblogs.com/iamstudy/" target="_blank" rel="external">L3m0n</a></li>
<li><a href="http://www.cnblogs.com/0xmuhe/" target="_blank" rel="external">0xmuhe</a></li>
<li><a href="http://www.tasfa.cn/" target="_blank" rel="external">Tasfa</a></li>
<li><a href="http://blog.l1n3.net/" target="_blank" rel="external">LinE</a></li>
<li><a href="http://www.isecer.com/" target="_blank" rel="external">Virink</a></li>
<li><a href="http://hijacks.in/" target="_blank" rel="external">LateRain</a></li>
<li><a href="http://blog.kidoplay.com/" target="_blank" rel="external">Kido</a></li>
<li><a href="http://www.jayjaydream.com/" target="_blank" rel="external">JACKY</a></li>
<li><a href="http://3k-gov.cnxflm.com/" target="_blank" rel="external">3K</a></li>
<li><a href="http://code.verofess.com/" target="_blank" rel="external">VeroFess</a></li>
<li><a href="http://wyatu.cn/" target="_blank" rel="external">WyAtu</a></li>
<li><a href="http://www.0aa.me/" target="_blank" rel="external">Mosuan</a></li>
<li><a href="http://bestwing.me/" target="_blank" rel="external">Swing</a></li>
<li><a href="http://www.xd-a8.com/" target="_blank" rel="external">Xda8</a></li>
<li><a href="http://www.ninjahack.cn/" target="_blank" rel="external">DennisShaw</a></li>
<li><a href="http://www.ohlinge.cn/" target="_blank" rel="external">0hlin9e</a></li>
<li><a href="http://bluerainlyj.cn" target="_blank" rel="external">PillowMoon</a></li>
<li><a href="http://www.kavsec.com/" target="_blank" rel="external">Kav</a></li>
<li><a href="http://www.exp1oit.com/" target="_blank" rel="external">Exploit School</a></li>
<li><a href="https://darsoon.github.io/" target="_blank" rel="external">darsoon</a></li>
<li><a href="https://www.lshack.cn" target="_blank" rel="external">lsh4ck’s blog</a></li>
<li><a href="http://www.cnnetarmy.com/" target="_blank" rel="external">cnnetarmy</a></li>
<li><a href="http://www.venenof.com/" target="_blank" rel="external">Veneno</a></li>
</ul>
<h1 id="论坛社区媒体"><a href="#论坛社区媒体" class="headerlink" title="论坛社区媒体"></a>论坛社区媒体</h1><ul>
<li><a href="http://www.evil0x.com/" target="_blank" rel="external">邪恶十六进制</a></li>
<li><a href="http://www.mottoin.com" target="_blank" rel="external">Mottoin-安全媒体</a></li>
<li><a href="http://www.ixsec.org/" target="_blank" rel="external">iSafe-爱安全</a></li>
<li><a href="http://www.secbox.cn/" target="_blank" rel="external">Secbox-安全盒子</a></li>
<li><a href="http://www.exp1oit.com/" target="_blank" rel="external">Exploit School</a></li>
<li><a href="http://bbs.whitecap100.org/" target="_blank" rel="external">白帽100</a></li>
<li><a href="http://r00ts.cc/" target="_blank" rel="external">r00ts小组</a></li>
<li><a href="http://bbs.iosmosis.org/" target="_blank" rel="external">iosmosis社区</a></li>
<li><a href="http://www.hi-ourlife.com/" target="_blank" rel="external">米斯特安全</a></li>
<li><a href="http://www.wooyun.pw/" target="_blank" rel="external">神刃安全</a></li>
<li><a href="http://www.secist.com/" target="_blank" rel="external">即刻安全</a></li>
<li><a href="http://anyun.org/" target="_blank" rel="external">安云网</a></li>
<li><a href="http://www.unlost.cn/" target="_blank" rel="external">Unlost Team</a></li>
</ul>
]]></content>
    </entry>
    
  
</search>
